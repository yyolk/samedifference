<!DOCTYPE html>
<html>
  <head>
    <title>SameDifference</title>
    <link rel="stylesheet" href="style/screen.css" type="text/css">
  </head>
  <body>
    
    <!-- content goes here -->

  </body>
  <script src="/_utils/script/sha1.js"></script>
  <script src="/_utils/script/json2.js"></script>
  <script src="/_utils/script/jquery.js"></script>
  <script src="/_utils/script/jquery.couch.js"></script>
  <script src="vendor/couchapp/jquery.couchLogin.js"></script>
  <script src="vendor/couchapp/jquery.couchProfile.js"></script>
  <script src="vendor/couchapp/md5.js"></script>
  <script src="vendor/couchapp/jquery.mustache.js"></script>

<!-- templates used by app.js -->
  <script id="new-message" type="text/x-mustache" charset="utf-8">
      <div style="clear:left;"></div>
  </script>
  <script id="recent-messages" type="text/x-mustache" charset="utf-8">
        <div id="items">
          {{#items}}
            <div>
              <p style="background-color:{{{color}}}">&nbsp;</p>
            </div>
          {{/items}}
        </div>
  </script>
  <script src="script/app.js"></script>

  <script>
    function setColor(){
      var colors = [
            "#8AB692",
            "#5685A1",
            "#46A198",
            "#57907D",
            "#8DB1A7",
            "#83A1A3",
            "#ACC9CD",
            "#75A5B1",
            "#688D97"
          ];

      //simple random by size of list
      return colors[Math.floor(Math.random()*colors.length)];
      
    }
    //$("input[name='color']").val(setColor());
    
       $.fn.serializeObject = function() {
         var o = {};
         var a = this.serializeArray();
         $.each(a, function() {
             if (o[this.name]) {
                 if (!o[this.name].push) {
                     o[this.name] = [o[this.name]];
                 }
                 o[this.name].push(this.value || '');
             } else {
                 o[this.name] = this.value || '';
             }
         });
         return o;
     };
    setColor();
      var path = unescape(document.location.pathname).split('/'),
        design = path[3],
        db = $.couch.db(path[1]);

        function drawItems() {
        db.view(design + "/recent-items", {
            descending : "true",
            limit : 50,
            update_seq : true,
            success : function(data) {
                setupChanges(data.update_seq);
                var them = $.mustache($("#recent-messages").html(), {
                    items : data.rows.map(function(r) {return r.value;})
                });
                $("body").prepend(them);
            }
        });
    function pushMessage(){
        
        var form = $("#create-message");//, doc = $(form).serializeObject();
        var doc = {};
        doc.created_at = new Date();
        //doc.message = "&nbsp;"
        doc.color = setColor();
        db.saveDoc(doc, {success : function() {
            
            }
        });
        setTimeout("pushMessage()", 1333);
    };

    pushMessage();


  </script>

</html>
